{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="container-wrapper">
    <div class="container-fluid">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <!-- Learning Block info column -->
                    <div class="col-sm-12 col-md-auto me-2">
                        <h class="display-6">{{ learning_block.name }}</h>
                        <h3 class="num-block-words">{{ block_words|length }} words</h>
                        {% if user.is_authenticated %}
                            <h6 class="num-learned-words">{{ num_learned_words }} learned</h6>
                        {% endif %}

                        <!-- Button to quiz_learn -->
                        <form method="POST" action="{% url 'quiz_learn' %}" class="my-2">
                            {% csrf_token %}
                            <input type="hidden" value="{{ learning_block.slug }}" name="learning_block">
                            {% if num_learned_words == block_words|length %}
                                <span class="tt" data-bs-toggle="tooltip" title="{{ gui_messages.block_fully_learned }}">
                                    <input type='submit' class="btn btn-outline-secondary" value="Learn Words" disabled> 
                                </span>
                            {% else %}
                                <input type='submit' class="btn btn-primary" value="Learn Words"> 
                            {% endif %}
                        </form>
                        
                        <!-- Button to quiz_review -->
                        <form action="{% url 'quiz_review' %}" method="POST" class="my-2">
                            {% csrf_token %}
                            <input type="hidden" value="{{ learning_block.slug }}" name="learning_block">
                            {% if not user.is_authenticated %}
                                <span class="tt" data-bs-toggle="tooltip" title="{{ gui_messages.log_in_to_review }}">
                                    <input type='submit' class="btn btn-outline-secondary" value="Review" disabled> 
                                </span>
                            {% elif num_learned_words == 0 %}
                                <span class="tt" data-bs-toggle="tooltip" title="{{ gui_messages.no_review_words }}">
                                    <input type='submit' class="btn btn-outline-secondary" value="Review" disabled> 
                                </span>
                            {% else %}
                                <input type='submit' class="btn btn-primary" value="Review"> 
                            {% endif %}
                        </form>

                        <!-- Button to quiz_multiple_choice -->
                        <form method="POST" action="{% url 'quiz_multiple_choice' %}" class="my-2">
                            {% csrf_token %}
                            <input type="hidden" value="{{ learning_block.slug }}" name="learning_block">
                            {% if num_learned_words == block_words|length %}
                                <input type='submit' class="btn btn-outline-success" value="Start Quiz">
                            {% else %}
                                <input type='submit' class="btn btn-outline-secondary" value="Start Quiz">
                            {% endif %}
                        </form>
                        
                    </div>

                    <!-- Block mastery level column -->
                    <div class="col-sm-12 col-md-auto">
                        <!-- Block mastery level text -->
                        <div class="row">
                            <nobr>
                                <a href="{% url 'user_block_detail' learning_block.slug %}">Block Mastery Level</a> {{ block_mastery_level|floatformat:3 }} / 6
                                <span class="tt" data-bs-toggle="tooltip" title="{{ gui_messages.block_mastery_level_help }}">
                                    <i class="fa-solid fa-circle-info"></i>
                                </span>
                            </nobr>
                        </div>
                        
                        <!-- Doughnut chart -->
                        <div class="row">
                            <div id="ml-doughnut" class="chart doughnut-chart-container">
                                {{ bml_fractional_part|json_script:"bml-doughnut-fractional" }}
                                <canvas id="doughnut" class="doughnut"></canvas>
                                <p class="doughnut-chart-text">{{ bml_whole_part|floatformat:0 }}</p>
                            </div>
                        </div>    
                    </div>


                    <div class="col-sm-12 col-md-8">
                        <div id="ml-chart" class="mastery-level-chart">
                            {{ ml_chart|json_script:"ml-chart-data" }}
                            <canvas id="mastery-level-chart"></canvas>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="row">
            <!-- List of words block -->
            <div class="col-sm-12 col-md-2 pt-2">
                <div class="card word-list-card">
                    <div class="card-header">List of words</div>
                    <ol class="list-group py-2 px-3">
                        {% for word in block_words %}
                            <li class="mx-3">
                                <div class="row">
                                    <div class="col">{{ word.name }}</div>
                                    <div class="col">{{ word.translation }}</div>
                                </div>
                            </li>
                        {% endfor %}
                    </ol>
                </div>
            </div>

            <!-- Theory block -->
            <div class="col-sm-12 col-md-8 pt-2">
                <div class="card">
                    <div class="card-header">Theory</div>
                    <div class="card-body">
                        <p class="card-text">{{ learning_block.theory|safe }}</p>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>

<script src="{% static 'js/charts.js' %}"></script>

{% endblock %}